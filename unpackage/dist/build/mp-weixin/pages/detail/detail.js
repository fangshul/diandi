(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/detail/detail"],{2329:function(t,a,i){"use strict";(function(t){i("cc27");n(i("66fd"));var a=n(i("a278"));function n(t){return t&&t.__esModule?t:{default:t}}t(a.default)}).call(this,i("543d")["createPage"])},"6a04":function(t,a,i){"use strict";(function(t){Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var n=o(i("70d3")),e=o(i("16e9"));function o(t){return t&&t.__esModule?t:{default:t}}var s=function(){i.e("components/Popup").then(function(){return resolve(i("817a"))}.bind(null,i)).catch(i.oe)},d=function(){Promise.all([i.e("common/vendor"),i.e("components/uni-popup/uni-popup")]).then(function(){return resolve(i("5910"))}.bind(null,i)).catch(i.oe)},u=function(){i.e("components/uni-popup/uni-popup-dialog").then(function(){return resolve(i("7ffd"))}.bind(null,i)).catch(i.oe)},c=function(){Promise.all([i.e("common/vendor"),i.e("components/uni-calendar/uni-calendar")]).then(function(){return resolve(i("60c0"))}.bind(null,i)).catch(i.oe)},l={components:{uniPopup:d,uniPopupDialog:u,uniCalendar:c,popup:s},data:function(){return{touchT:"",touchE:"",ifHead:!0,ifFoot:!1,ifNote:!1,noteData:"",diandi:"",imgList:[],data:"",date:"",mon:"",ifedit:!1,toId:"",returnTime:"",imgIndex:"",token:"",ifNullImg:!1,ifadd:"true",startX:"",startY:"",animation_1:"",animation_2:"",animation_3:"",animation_4:"",contentAni:"",contentAni_new:"",toNext:!1,out:!0,nowDianai:"",nowIndedx:"",page:"",allData:"",lock:!0,idList:[],ifhot:!0,firstImg:0,startscroll:""}},methods:{preImg:function(){this.touchE-this.touchT<350&&(this.firstImg>0&&(this.firstImg--,this.toId="img_"+this.firstImg),this.firstImg===this.nowDianai.imgList.length-1?this.ifFoot=!0:this.ifFoot=!1,0===this.firstImg?this.ifHead=!0:this.ifHead=!1)},touchstartImg:function(){this.touchT=(new Date).getTime()},touchendImg:function(){this.touchE=(new Date).getTime()},nextImg:function(){this.touchE-this.touchT<350&&(this.firstImg<this.nowDianai.imgList.length-1&&(this.firstImg++,this.toId="img_"+this.firstImg),this.firstImg===this.nowDianai.imgList.length-1?this.ifFoot=!0:this.ifFoot=!1,0===this.firstImg?this.ifHead=!0:this.ifHead=!1)},preview:function(t){console.log("img",t),wx.previewImage({current:t,urls:this.nowDianai.imgList})},changePageStart:function(t){this.startX=t.touches[0].pageX,this.startY=t.touches[0].pageY},changePageMove:function(t){var a=this,i=t.touches[0].pageX,o=t.touches[0].pageY,s=i-this.startX,d=o-this.startY;Math.abs(d)<Math.abs(s)&&this.lock&&(this.lock=!1,s>0?1===this.page&&0===this.nowIndedx?(e.default.note("当前已是最新点滴",this),this.lock=!0):0===this.nowIndedx?(this.page--,this.nowIndedx=9,wx.showLoading({title:"正在加载数据...",mask:!0}),"个人点滴"===this.data.type?n.default.getRequest("/personal/essays",{tag:this.data.diandiType,page:this.page},(function(t){if(200===t.data.code){for(var i=[],n=0;n<t.data.data.length;n++)i.push(t.data.data[n].id);a.idList=i,a.changPre(),a.getDataFun("/personal/essay",a.idList[a.nowIndedx],"nowDianai")}else e.default.note("无法获取数据",a)}),(function(t){console.log(t)}),"GET"):n.default.getRequest("/class/essays",{page:this.page},(function(t){if(200===t.data.code){for(var i=[],n=0;n<t.data.data.length;n++)i.push(t.data.data[n].id);a.idList=i,a.changPre(),a.getDataFun("/class/essay",a.idList[a.nowIndedx],"nowDianai")}else e.default.note("无法获取数据",a)}),(function(t){console.log(t)}))):(this.nowIndedx--,this.changPre(),"个人点滴"===this.data.type?this.getDataFun("/personal/essay",this.idList[this.nowIndedx],"nowDianai"):this.getDataFun("/class/essay",this.idList[this.nowIndedx],"nowDianai")):this.idList.length<10&&this.nowIndedx===this.idList.length-1?(e.default.note("当前已是最后一条点滴",this),this.lock=!0):this.nowIndedx===this.idList.length-1?(this.page++,this.nowIndedx=0,wx.showLoading({title:"正在加载数据...",mask:!0}),"个人点滴"===this.data.type?n.default.getRequest("/personal/essays",{tag:this.data.diandiType,page:this.page},(function(t){if(200===t.data.code)if(0===t.data.data.length)wx.hideLoading(),e.default.note("当前已是最后一条点滴",a),a.lock=!0;else{for(var i=[],n=0;n<t.data.data.length;n++)i.push(t.data.data[n].id);a.idList=i,a.changeNext(),a.getDataFun("/personal/essay",a.idList[a.nowIndedx],"nowDianai")}else e.default.note("无法获取数据",a)}),(function(t){console.log(t)}),"GET"):n.default.getRequest("/class/essays",{page:this.page},(function(t){if(200===t.data.code)if(a.allData=t.data.data,0===t.data.data.length)wx.hideLoading(),e.default.note("当前已是最后一条点滴",a),a.lock=!0;else{for(var i=[],n=0;n<t.data.data.length;n++)i.push(t.data.data[n].id);a.changeNext(),a.idList=i,a.getDataFun("/class/essay",a.idList[a.nowIndedx],"nowDianai")}else e.default.note("无法获取数据",a)}),(function(t){console.log(t)}))):(this.nowIndedx++,this.changeNext(),"个人点滴"===this.data.type?this.getDataFun("/personal/essay",this.idList[this.nowIndedx],"nowDianai"):this.getDataFun("/class/essay",this.idList[this.nowIndedx],"nowDianai")))},changPre:function(){var t=this;this.animation_1="toTwo",this.animation_2="toThree",this.animation_3="toFour",this.animation_4="toFive",this.contentAni="preOut",this.contentAni_new="preCome",this.toNext=!0,setTimeout((function(){t.animation_1="",t.animation_2="",t.animation_3="",t.animation_4="",t.contentAni="",t.contentAni_new="",t.out=!1}),1e3),setTimeout((function(){t.out=!0,t.toNext=!1,t.lock=!0}),1100)},changeNext:function(){var t=this;this.animation_1="toTwo",this.animation_2="toThree",this.animation_3="toFour",this.animation_4="toFive",this.contentAni="out",this.contentAni_new="come",this.toNext=!0,setTimeout((function(){t.animation_1="",t.animation_2="",t.animation_3="",t.animation_4="",t.contentAni="",t.contentAni_new=""}),1e3),setTimeout((function(){t.out=!1}),750),setTimeout((function(){t.out=!0,t.toNext=!1,t.lock=!0}),1100)},deleteDiandi:function(){this.$refs.popupDialog.open()},confirmChange:function(){this.$refs.popupDialogSave.open()},cancelChange:function(){this.ifedit=!1},confirmSave:function(t){for(var a=this,i="",o=0;o<this.nowDianai.imgList.length;o++)i=i+this.nowDianai.imgList[o]+";";this.ifedit=!1,"个人点滴"===this.data.type?n.default.getRequest("/personal/essay",{id:parseInt(this.data.id),writed_at:this.nowDianai.returnTime,tag:parseInt(this.data.tag),content:this.nowDianai.diandi.content,image:i},(function(t){a.lock=!1,200===t.data.code?e.default.note("修改成功",a):e.default.note(t.data.msg,a)}),(function(t){console.log(t)}),"PUT","application/x-www-form-urlencoded"):n.default.getRequest("/class/essay",{id:parseInt(this.data.id),classid:parseInt(this.data.classid),writed_at:this.nowDianai.returnTime,content:this.nowDianai.diandi.content,image:i},(function(t){200===t.data.code?e.default.note("修改成功",a):e.default.note(t.data.msg,a)}),(function(t){console.log(t)}),"PUT","application/x-www-form-urlencoded"),t()},openCancel:function(){this.ifedit&&this.$refs.calendar.open()},deleteFun:function(a){var i=this;n.default.getRequest(a,{id:parseInt(this.data.id)},(function(a){200===a.data.code&&"ok"===a.data.msg?(e.default.note("删除成功",i),setTimeout((function(){t.navigateBack()}),1500)):e.default.note(a.data.msg)}),(function(t){console.log(t)}),"DELETE")},getDataFun:function(a,i,o){var s=this;n.default.getRequest(a,{id:i},(function(a){if(console.log(a),200===a.data.code){wx.hideLoading();var i={};i.returnTime="".concat(a.data.data.writed_at.split("T")[0]," ").concat(a.data.data.writed_at.split("T")[1].split("+")[0]),i.diandi=a.data.data,i.date=e.default.getDay(a.data.data.writed_at).day,i.mon=e.default.getDay(a.data.data.writed_at).mon,i.imgList=a.data.data.image.split(";"),""===a.data.data.image.split(";")[a.data.data.image.split(";").length-1]&&i.imgList.pop(),s[o]=i}else e.default.note(a.data.msg,s),setTimeout((function(){t.navigateBack()}),1500)}),(function(t){console.log(t)}),"GET")},dialogConfirm:function(t){"个人点滴"===this.data.type?this.deleteFun("/personal/essay"):this.deleteFun("/class/essay"),t()},edit:function(){this.ifedit=!0,this.toId="add",this.lock=!1},addImg:function(){var t=this;wx.chooseImage({count:9,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(a){var i=a.tempFilePaths;t.upload(0,0,0,i.length,i)}})},upload:function(t,a,i,n,e){var o=this,s=this;wx.showLoading({title:"上传中...",mask:!0});var d=t,u=a,c=i;wx.uploadFile({url:"https://wy.lujiahaoo.cn/dddx/api/upload/image",filePath:e[d],name:"image",header:{"content-type":"application/json",Authorization:"Bearer "+this.token},success:function(t){wx.hideLoading(),u++;var a=JSON.parse(t.data);200===a.code&&o.nowDianai.imgList.push(a.data[0])},fail:function(t){c++},complete:function(){d++,d===n?o.ifNullImg=!1:s.upload(d,u,c,n,e)}})},deleteImg:function(t){this.$refs.deleteImg.open(),this.imgIndex=t},confirmDeleteImg:function(t){this.nowDianai.imgList.splice(this.imgIndex,1),e.default.note("删除成功",this),t()},change:function(t){var a=new Date,i=a.getHours(),n=a.getMinutes(),o=a.getSeconds();this.nowDianai.date=e.default.timeModel(t.date),this.nowDianai.mon=e.default.month(t.month),this.nowDianai.returnTime="".concat(t.fulldate," ").concat(e.default.timeModel(i),":").concat(e.default.timeModel(n),":").concat(e.default.timeModel(o))}},mounted:function(){"code"===wx.getStorageSync("bgColor")?this.ifhot=!1:this.ifhot=!0,this.token=wx.getStorageSync("token")},onLoad:function(t){var a=this;this.data=t,wx.showLoading({title:"正在加载数据",mask:!0}),t.id=parseInt(t.id),this.page=parseInt(t.page),"个人点滴"===this.data.type?(this.getDataFun("/personal/essay",t.id,"nowDianai"),n.default.getRequest("/personal/essays",{tag:t.diandiType,page:this.page},(function(i){if(200===i.data.code){a.nowIndedx=-1;for(var o=[],s=0;s<i.data.data.length;s++)i.data.data[s].id===t.id&&(a.nowIndedx=s),o.push(i.data.data[s].id);if(-1===a.nowIndedx){var d=[];a.page++,n.default.getRequest("/personal/essays",{tag:t.diandiType,page:a.page},(function(i){for(var n=0;n<i.data.data.length;n++)i.data.data[n].id===t.id&&(a.nowIndedx=n),d.push(i.data.data[n].id);a.idList=d}),(function(t){}),"GET")}else a.idList=o}else wx.hideLoading(),e.default.note("无法获取数据",a)}),(function(t){console.log(t)}),"GET")):(this.getDataFun("/class/essay",t.id,"nowDianai"),this.ifadd=this.data.ifadd,n.default.getRequest("/class/essays",{page:this.page},(function(i){if(200===i.data.code){a.nowIndedx=-1;for(var o=[],s=0;s<i.data.data.length;s++)i.data.data[s].id===t.id&&(a.nowIndedx=s),o.push(i.data.data[s].id);if(-1===a.nowIndedx){var d=[];a.page++,n.default.getRequest("/personal/essays",{tag:t.diandiType,page:a.page},(function(i){for(var n=0;n<i.data.data.length;n++)i.data.data[n].id===t.id&&(a.nowIndedx=n),d.push(i.data.data[n].id);a.idList=d}),(function(t){}),"GET")}else a.idList=o}else wx.hideLoading(),e.default.note("无法获取数据",a)}),(function(t){console.log(t)}),"GET"))},watch:{nowDianai:function(){0===this.nowDianai.imgList.length||""===this.nowDianai.imgList||this.nowDianai.imgList===[]?this.ifNullImg=!0:this.ifNullImg=!1}}};a.default=l}).call(this,i("543d")["default"])},"8d3b":function(t,a,i){"use strict";var n=i("ba5f"),e=i.n(n);e.a},9199:function(t,a,i){"use strict";i.d(a,"b",(function(){return e})),i.d(a,"c",(function(){return o})),i.d(a,"a",(function(){return n}));var n={uniPopup:function(){return Promise.all([i.e("common/vendor"),i.e("components/uni-popup/uni-popup")]).then(i.bind(null,"5910"))},uniCalendar:function(){return Promise.all([i.e("common/vendor"),i.e("components/uni-calendar/uni-calendar")]).then(i.bind(null,"60c0"))}},e=function(){var t=this,a=t.$createElement;t._self._c},o=[]},a278:function(t,a,i){"use strict";i.r(a);var n=i("9199"),e=i("ef10");for(var o in e)"default"!==o&&function(t){i.d(a,t,(function(){return e[t]}))}(o);i("8d3b");var s,d=i("f0c5"),u=Object(d["a"])(e["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],s);a["default"]=u.exports},ba5f:function(t,a,i){},ef10:function(t,a,i){"use strict";i.r(a);var n=i("6a04"),e=i.n(n);for(var o in n)"default"!==o&&function(t){i.d(a,t,(function(){return n[t]}))}(o);a["default"]=e.a}},[["2329","common/runtime","common/vendor"]]]);