(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index"],{"272c":function(n,t,i){"use strict";(function(n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var e=s(i("60fa")),o=s(i("1a6b"));function s(n){return n&&n.__esModule?n:{default:n}}var a=function(){i.e("components/MyDiandi").then(function(){return resolve(i("a3b2"))}.bind(null,i)).catch(i.oe)},l=function(){Promise.all([i.e("common/vendor"),i.e("components/ClassDiandi")]).then(function(){return resolve(i("6240"))}.bind(null,i)).catch(i.oe)},f=function(){i.e("components/Personal").then(function(){return resolve(i("7168"))}.bind(null,i)).catch(i.oe)},c=function(){i.e("components/Set").then(function(){return resolve(i("9c8f"))}.bind(null,i)).catch(i.oe)},u=function(){i.e("components/Popup").then(function(){return resolve(i("60a7"))}.bind(null,i)).catch(i.oe)},r={components:{MyDiandi:a,ClassDiandi:l,Personal:f,Set:c,popup:u},data:function(){return{infoData:"",userInfo:{},canIUse:wx.canIUse("button.open-type.getUserInfo"),hasUserInfo:!1,if_info:!0,ifHaveClass:!1,title:"个人点滴",ifMyClass:!0,ifInitClass:!1,ifPersonal:!1,ifphone:!1,iflogin:!1,permission:{},refresh:!1,reallLogin:!0,set:!1,ifNote:!1,noteData:"",inivCode:"",inviClass:"",ifhot:!0}},methods:{cancelLoginBox:function(n){n.currentTarget.id===n.target.id&&(this.reallLogin=!0)},indexLogin:function(){this.reallLogin=!1,this.closeInfo()},toLogin:function(){this.reallLogin=!1,this.changeToSelf()},classChange:function(){this.ifHaveClass=!1},getClass:function(n){this.ifHaveClass=!0,this.ifInitClass=!1,this.ifMyClass=!0,this.ifPersonal=!1},changeToSet:function(){this.ifMyClass=!1,this.ifInitClass=!1,this.ifPersonal=!1,this.set=!0,this.closeInfo()},changeToPersonal:function(){this.ifMyClass=!1,this.ifInitClass=!1,this.ifPersonal=!0,this.set=!1,this.closeInfo()},changeToClass:function(){this.ifHaveClass?(this.title="班级点滴",this.ifMyClass=!0,this.ifInitClass=!1):(this.title="班级点滴",this.ifMyClass=!1,this.ifInitClass=!0),this.ifPersonal=!1,this.set=!1,this.closeInfo()},changeToSelf:function(){this.title="个人点滴",this.ifMyClass=!0,this.ifInitClass=!1,this.ifPersonal=!1,this.set=!1,this.closeInfo()},closeInfo:function(){this.if_info=!0},getinfo:function(){this.if_info=!1},login:function(){var t=this;wx.login({success:function(i){i.code&&(wx.showLoading({title:"正在登陆...",mask:!0}),wx.request({url:"https://wy.lujiahaoo.cn/dddx/api/auth/login/wxmp",method:"POST",data:{code:i.code,name:t.userInfo.nickName,avatar:t.userInfo.avatarUrl},success:function(i){wx.hideLoading(),console.log("login",i),200===i.data.code?(o.default.note("登录成功",t),n.report("login","登录成功"),t.iflogin=!0,t.reallLogin=!0,wx.setStorageSync("token",i.data.data.token),t.info()):(t.reallLogin=!0,o.default.note(i.data.msg,t))},fail:function(n){console.log(n)}}))}})},bindGetUserInfo:function(n){var t=this;n.detail.userInfo?wx.getUserInfo({lang:"zh_CN",success:function(n){t.userInfo=n.userInfo,wx.showLoading({title:"正在登陆...",mask:!0}),t.login(),t.userInfoReadyCallback&&t.userInfoReadyCallback(n)}}):o.default.note("无法获取您的信息",this)},info:function(){var n=this;e.default.getRequest("/user/profile",{},(function(t){console.log(t),wx.hideLoading(),200===t.data.code?(n.iflogin=!0,n.reallLogin=!0,n.infoData=t.data.data,getApp().globalData.personal=n.infoData,n.permission=n.infoData.permission,null!=n.infoData.class?n.ifHaveClass=!0:n.ifHaveClass=!1):50001!==t.data.code&&50002!==t.data.code&&50003!==t.data.code||(n.iflogin=!1,console.log("有权限但需要重新登陆"))}),(function(n){console.log("error",n)}),"GET")}},watch:{iflogin:function(){wx.hideLoading(),!0===this.iflogin?this.reallLogin=!0:this.reallLogin=!1}},onLoad:function(n){"true"===n.share&&(this.inivCode=n.code,this.inviClass=n.classId,this.changeToClass())},mounted:function(){var t=this;"code"===wx.getStorageSync("bgColor")?this.ifhot=!1:this.ifhot=!0,wx.showLoading({title:"正获取信息...",mask:!0}),wx.getSetting({success:function(i){i.authSetting["scope.userInfo"]?wx.getUserInfo({lang:"zh_CN",success:function(n){t.userInfo=n.userInfo,getApp().globalData.userInfo=t.userInfo,t.info(),t.userInfoReadyCallback&&t.userInfoReadyCallback(n)}}):(wx.hideLoading(),console.log("没有授权",getApp().globalData.ifFirst),getApp().globalData.ifFirst&&(n.redirectTo({url:"../guide/guide"}),getApp().globalData.ifFirst=!1),t.iflogin=!1)},fail:function(n){console.log(n)}})}};t.default=r}).call(this,i("543d")["default"])},"2bbe":function(n,t,i){"use strict";var e,o=function(){var n=this,t=n.$createElement;n._self._c},s=[];i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return s})),i.d(t,"a",(function(){return e}))},"9d38":function(n,t,i){},bd83:function(n,t,i){"use strict";i.r(t);var e=i("272c"),o=i.n(e);for(var s in e)"default"!==s&&function(n){i.d(t,n,(function(){return e[n]}))}(s);t["default"]=o.a},ccba:function(n,t,i){"use strict";var e=i("9d38"),o=i.n(e);o.a},dd73:function(n,t,i){"use strict";(function(n){i("ae52"),i("921b");e(i("66fd"));var t=e(i("ea37"));function e(n){return n&&n.__esModule?n:{default:n}}n(t.default)}).call(this,i("543d")["createPage"])},ea37:function(n,t,i){"use strict";i.r(t);var e=i("2bbe"),o=i("bd83");for(var s in o)"default"!==s&&function(n){i.d(t,n,(function(){return o[n]}))}(s);i("ccba");var a,l=i("f0c5"),f=Object(l["a"])(o["default"],e["b"],e["c"],!1,null,null,null,!1,e["a"],a);t["default"]=f.exports}},[["dd73","common/runtime","common/vendor"]]]);