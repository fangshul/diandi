(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index"],{"0c7a":function(n,t,e){"use strict";(function(n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=s(e("70d3")),o=s(e("16e9"));function s(n){return n&&n.__esModule?n:{default:n}}var a=function(){e.e("components/MyDiandi").then(function(){return resolve(e("0e69"))}.bind(null,e)).catch(e.oe)},l=function(){Promise.all([e.e("common/vendor"),e.e("components/ClassDiandi")]).then(function(){return resolve(e("0f1e"))}.bind(null,e)).catch(e.oe)},f=function(){e.e("components/Personal").then(function(){return resolve(e("568d"))}.bind(null,e)).catch(e.oe)},c=function(){e.e("components/Set").then(function(){return resolve(e("d0f7"))}.bind(null,e)).catch(e.oe)},u=function(){e.e("components/Popup").then(function(){return resolve(e("817a"))}.bind(null,e)).catch(e.oe)},r={components:{MyDiandi:a,ClassDiandi:l,Personal:f,Set:c,popup:u},data:function(){return{infoData:"",userInfo:{},canIUse:wx.canIUse("button.open-type.getUserInfo"),hasUserInfo:!1,if_info:!0,ifHaveClass:!1,title:"个人点滴",ifMyClass:!0,ifInitClass:!1,ifPersonal:!1,ifphone:!1,iflogin:!1,permission:{},refresh:!1,reallLogin:!0,set:!1,ifNote:!1,noteData:"",inivCode:"",inviClass:"",ifhot:!0}},methods:{cancelLoginBox:function(n){n.currentTarget.id===n.target.id&&(this.reallLogin=!0)},indexLogin:function(){this.reallLogin=!1,this.closeInfo()},toLogin:function(){this.reallLogin=!1,this.changeToSelf()},classChange:function(){this.ifHaveClass=!1},getClass:function(n){this.ifHaveClass=!0,this.ifInitClass=!1,this.ifMyClass=!0,this.ifPersonal=!1},changeToSet:function(){this.ifMyClass=!1,this.ifInitClass=!1,this.ifPersonal=!1,this.set=!0,this.closeInfo()},changeToPersonal:function(){this.ifMyClass=!1,this.ifInitClass=!1,this.ifPersonal=!0,this.set=!1,this.closeInfo()},changeToClass:function(){this.ifHaveClass?(this.title="班级点滴",this.ifMyClass=!0,this.ifInitClass=!1):(this.title="班级点滴",this.ifMyClass=!1,this.ifInitClass=!0),this.ifPersonal=!1,this.set=!1,this.closeInfo()},changeToSelf:function(){this.title="个人点滴",this.ifMyClass=!0,this.ifInitClass=!1,this.ifPersonal=!1,this.set=!1,this.closeInfo()},closeInfo:function(){this.if_info=!0},getinfo:function(){this.if_info=!1},login:function(){var t=this;wx.login({success:function(e){e.code&&(wx.showLoading({title:"正在登陆...",mask:!0}),wx.request({url:"https://wy.lujiahaoo.cn/dddx/api/auth/login/wxmp",method:"POST",data:{code:e.code,name:t.userInfo.nickName,avatar:t.userInfo.avatarUrl},success:function(e){wx.hideLoading(),console.log("login",e),200===e.data.code?(o.default.note("登录成功",t),n.report("login","登录成功"),t.iflogin=!0,t.reallLogin=!0,wx.setStorageSync("token",e.data.data.token),t.info()):(t.reallLogin=!0,o.default.note(e.data.msg,t))},fail:function(n){console.log(n)}}))}})},bindGetUserInfo:function(n){var t=this;n.detail.userInfo?wx.getUserInfo({lang:"zh_CN",success:function(n){t.userInfo=n.userInfo,wx.showLoading({title:"正在登陆...",mask:!0}),t.login(),t.userInfoReadyCallback&&t.userInfoReadyCallback(n)}}):o.default.note("无法获取您的信息",this)},info:function(){var n=this;i.default.getRequest("/user/profile",{},(function(t){console.log(t),wx.hideLoading(),200===t.data.code?(n.iflogin=!0,n.reallLogin=!0,n.infoData=t.data.data,getApp().globalData.personal=n.infoData,n.permission=n.infoData.permission,null!=n.infoData.class?n.ifHaveClass=!0:n.ifHaveClass=!1):50001===t.data.code||50002===t.data.code||50003===t.data.code?(n.iflogin=!1,console.log("有权限但需要重新登陆")):o.default.note("无法获取您的信息",n)}),(function(n){console.log("error",n)}),"GET")}},watch:{iflogin:function(){wx.hideLoading(),!0===this.iflogin?this.reallLogin=!0:this.reallLogin=!1}},onLoad:function(n){"true"===n.share&&(this.inivCode=n.code,this.inviClass=n.classId,this.changeToClass())},mounted:function(){var t=this;"code"===wx.getStorageSync("bgColor")?this.ifhot=!1:this.ifhot=!0,wx.showLoading({title:"正获取信息...",mask:!0}),wx.getSetting({success:function(e){e.authSetting["scope.userInfo"]?wx.getUserInfo({lang:"zh_CN",success:function(n){t.userInfo=n.userInfo,getApp().globalData.userInfo=t.userInfo,t.info(),t.userInfoReadyCallback&&t.userInfoReadyCallback(n)}}):(wx.hideLoading(),console.log("没有授权",getApp().globalData.ifFirst),getApp().globalData.ifFirst&&(n.redirectTo({url:"../guide/guide"}),getApp().globalData.ifFirst=!1),t.iflogin=!1)},fail:function(n){console.log(n)}})}};t.default=r}).call(this,e("543d")["default"])},1561:function(n,t,e){},3679:function(n,t,e){"use strict";var i;e.d(t,"b",(function(){return o})),e.d(t,"c",(function(){return s})),e.d(t,"a",(function(){return i}));var o=function(){var n=this,t=n.$createElement;n._self._c},s=[]},"53ee":function(n,t,e){"use strict";var i=e("1561"),o=e.n(i);o.a},cc9a:function(n,t,e){"use strict";e.r(t);var i=e("0c7a"),o=e.n(i);for(var s in i)"default"!==s&&function(n){e.d(t,n,(function(){return i[n]}))}(s);t["default"]=o.a},ecf1:function(n,t,e){"use strict";(function(n){e("cc27");i(e("66fd"));var t=i(e("f9f5"));function i(n){return n&&n.__esModule?n:{default:n}}n(t.default)}).call(this,e("543d")["createPage"])},f9f5:function(n,t,e){"use strict";e.r(t);var i=e("3679"),o=e("cc9a");for(var s in o)"default"!==s&&function(n){e.d(t,n,(function(){return o[n]}))}(s);e("53ee");var a,l=e("f0c5"),f=Object(l["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],a);t["default"]=f.exports}},[["ecf1","common/runtime","common/vendor"]]]);