(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/addDiandi/addDiandi"],{"035f":function(t,e,n){"use strict";(function(t){n("cc27");a(n("66fd"));var e=a(n("6299"));function a(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])},"1d32":function(t,e,n){"use strict";var a=n("3242"),i=n.n(a);i.a},3242:function(t,e,n){},6299:function(t,e,n){"use strict";n.r(e);var a=n("d4cf"),i=n("97c0");for(var o in i)"default"!==o&&function(t){n.d(e,t,(function(){return i[t]}))}(o);n("1d32");var c,u=n("f0c5"),s=Object(u["a"])(i["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],c);e["default"]=s.exports},"8b89":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=o(n("70d3")),i=o(n("16e9"));function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){Promise.all([n.e("common/vendor"),n.e("components/uni-calendar/uni-calendar")]).then(function(){return resolve(n("60c0"))}.bind(null,n)).catch(n.oe)},u=function(){n.e("components/Popup").then(function(){return resolve(n("817a"))}.bind(null,n)).catch(n.oe)},s={components:{uniCalendar:c,popup:u},data:function(){return{diandiData:"",nowLength:0,ifselect:!1,type:"选择类型",imgList:[],ifImg:!1,token:"",linkData:"",currentWeek:"",currentDate:"",returnTime:"",addToken:"",allType:"",typeID:"",diandiType:"",tampList:[],ifNote:!1,noteData:"",ifhot:!0,pushDiandi:!0}},onLoad:function(t){this.diandiType=t.type},methods:{preview:function(t){wx.previewImage({current:t,urls:this.tampList})},navigateBack:function(){t.navigateBack()},openCancel:function(){this.$refs.calendar.open()},change:function(t){console.log(t);var e=new Date,n=e.getHours(),a=e.getMinutes(),o=e.getSeconds();this.currentWeek=i.default.week(t.lunar.nWeek),this.currentDate="".concat(i.default.month(t.month),"  ").concat(t.date,",").concat(t.year),this.returnTime="".concat(t.fulldate," ").concat(this.timeModel(n),":").concat(this.timeModel(a),":").concat(this.timeModel(o))},dataLength:function(){this.nowLength=this.diandiData.length},open:function(){this.ifselect=!this.ifselect},select:function(t,e){this.type=t,this.ifselect=!1,this.typeID=e},addImg:function(){var t=this;wx.chooseImage({count:9,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){var n=e.tempFilePaths;t.tampList=t.tampList.concat(n),t.upload(0,0,0,e.tempFilePaths.length,e.tempFilePaths);for(var a=0;a<n.length;a++)t.$set(t.imgList,t.imgList.length,n[a])}})},upload:function(t,e,n,a,i){var o=this,c=this;wx.showLoading({title:"上传中...",mask:!0});var u=t,s=e,d=n;wx.uploadFile({url:"https://wy.lujiahaoo.cn/dddx/api/upload/image",filePath:i[u],name:"image",header:{"content-type":"application/json",Authorization:"Bearer "+this.token},success:function(t){wx.hideLoading(),s++;var e=JSON.parse(t.data);200===e.code&&(o.linkData=o.linkData+e.data+";")},fail:function(t){d++},complete:function(){u++,u===a||c.upload(u,s,d,a,i)}})},callImgBox:function(){this.ifImg=!0},cancelImgBox:function(){this.ifImg=!1},addDiandi:function(){var e=this;console.log("aa"),""===this.diandiData?i.default.note("点滴内容不能为空",this):"个人点滴"===this.diandiType?"选择类型"===this.type?i.default.note("请选择点滴类型",this):this.pushDiandi&&(this.pushDiandi=!1,wx.showLoading({title:"上传中..."}),wx.request({url:"https://wy.lujiahaoo.cn/dddx/api/personal/essay",method:"POST",data:{writed_at:this.returnTime,tag:this.typeID,content:this.diandiData,image:this.linkData},header:{"content-type":"application/x-www-form-urlencoded",Authorization:"Bearer "+this.token},success:function(n){wx.hideLoading(),200===n.data.code?(i.default.note("提交成功，点滴正在审核中...",e),t.report("per_essay","发布个人点滴"),setTimeout((function(){t.navigateBack(),e.pushDiandi=!0}),1500)):(i.default.note(n.data.msg,e),setTimeout((function(){e.pushDiandi=!0}),1500))},fail:function(t){console.log(t)}})):this.pushDiandi&&(this.pushDiandi=!1,wx.showLoading({title:"上传中..."}),wx.request({url:"https://wy.lujiahaoo.cn/dddx/api/class/essay",method:"POST",data:{writed_at:this.returnTime,content:this.diandiData,image:this.linkData},header:{"content-type":"application/x-www-form-urlencoded",Authorization:"Bearer "+this.token},success:function(n){e.pushDiandi=!0,wx.hideLoading(),200===n.data.code?(i.default.note("提交成功，点滴正在审核中...",e),t.report("class_essay","发布班级点滴"),setTimeout((function(){t.navigateBack()}),1501)):i.default.note(n.data.msg,e)},fail:function(t){console.log(t)}}))},timeModel:function(t){var e=t.toString();return 1===e.length&&(e="0"+e),e}},mounted:function(){var t=this;"code"===wx.getStorageSync("bgColor")?this.ifhot=!1:this.ifhot=!0,a.default.getRequest("/tag",{},(function(e){200===e.data.code&&(t.allType=e.data.data)}),(function(t){console.log(t)}),"GET"),this.token=wx.getStorageSync("token");var e=new Date,n=e.getFullYear(),o=e.getDate(),c=e.getMonth()+1,u=e.getDay(),s=e.getHours(),d=e.getMinutes(),r=e.getSeconds();this.currentWeek=i.default.week(u),this.currentDate="".concat(i.default.month(c),"  ").concat(o,",").concat(n),this.returnTime="".concat(n,"-").concat(this.timeModel(c),"-").concat(this.timeModel(o)," ").concat(this.timeModel(s),":").concat(this.timeModel(d),":").concat(this.timeModel(r))}};e.default=s}).call(this,n("543d")["default"])},"97c0":function(t,e,n){"use strict";n.r(e);var a=n("8b89"),i=n.n(a);for(var o in a)"default"!==o&&function(t){n.d(e,t,(function(){return a[t]}))}(o);e["default"]=i.a},d4cf:function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){return a}));var a={uniCalendar:function(){return Promise.all([n.e("common/vendor"),n.e("components/uni-calendar/uni-calendar")]).then(n.bind(null,"60c0"))}},i=function(){var t=this,e=t.$createElement;t._self._c},o=[]}},[["035f","common/runtime","common/vendor"]]]);