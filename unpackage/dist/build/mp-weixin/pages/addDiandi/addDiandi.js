(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/addDiandi/addDiandi"],{"0efa":function(t,e,n){},"3ba6":function(t,e,n){"use strict";n.r(e);var a=n("77ae"),i=n.n(a);for(var o in a)"default"!==o&&function(t){n.d(e,t,(function(){return a[t]}))}(o);e["default"]=i.a},"77ae":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=o(n("60fa")),i=o(n("1a6b"));function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){Promise.all([n.e("common/vendor"),n.e("components/uni-calendar/uni-calendar")]).then(function(){return resolve(n("fe3d"))}.bind(null,n)).catch(n.oe)},r=function(){n.e("components/Popup").then(function(){return resolve(n("60a7"))}.bind(null,n)).catch(n.oe)},u={components:{uniCalendar:c,popup:r},data:function(){return{diandiData:"",nowLength:0,ifselect:!1,type:"选择类型",imgList:[],ifImg:!1,token:"",linkData:"",currentWeek:"",currentDate:"",returnTime:"",addToken:"",allType:"",typeID:"",diandiType:"",tampList:[],ifNote:!1,noteData:"",ifhot:!0,pushDiandi:!0}},onLoad:function(t){this.diandiType=t.type},methods:{preview:function(t){wx.previewImage({current:t,urls:this.tampList})},navigateBack:function(){t.navigateBack()},week:function(t){switch(t){case 1:return"Monday";case 2:return"Tuesday";case 3:return"Wednesday";case 4:return"Thursday";case 5:return"Friday";case 6:return"Saturday";case 0:return"Sunday"}},month:function(t){switch(t){case 1:return"January";case 2:return"February";case 3:return"March";case 4:return"April";case 5:return"May";case 6:return"June";case 7:return"July";case 8:return"August";case 9:return"September";case 10:return"October";case 11:return"November";case 12:return"December"}},openCancel:function(){this.$refs.calendar.open()},change:function(t){var e=new Date,n=e.getHours(),a=e.getMinutes(),i=e.getSeconds();this.currentWeek=this.week(t.lunar.nWeek),this.currentDate="".concat(this.month(t.lunar.cMonth),"  ").concat(t.date,",").concat(t.year),this.returnTime="".concat(t.fulldate," ").concat(this.timeModel(n),":").concat(this.timeModel(a),":").concat(this.timeModel(i))},dataLength:function(){this.nowLength=this.diandiData.length},open:function(){this.ifselect=!this.ifselect},select:function(t,e){this.type=t,this.ifselect=!1,this.typeID=e},addImg:function(){var t=this;wx.chooseImage({count:9,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){var n=e.tempFilePaths;t.tampList=t.tampList.concat(n),t.upload(0,0,0,e.tempFilePaths.length,e.tempFilePaths);for(var a=0;a<n.length;a++)t.$set(t.imgList,t.imgList.length,n[a])}})},upload:function(t,e,n,a,i){var o=this,c=this;wx.showLoading({title:"上传中...",mask:!0});var r=t,u=e,s=n;wx.uploadFile({url:"https://wy.lujiahaoo.cn/dddx/api/upload/image",filePath:i[r],name:"image",header:{"content-type":"application/json",Authorization:"Bearer "+this.token},success:function(t){wx.hideLoading(),u++;var e=JSON.parse(t.data);200===e.code&&(o.linkData=o.linkData+e.data+";")},fail:function(t){s++},complete:function(){r++,r===a||c.upload(r,u,s,a,i)}})},callImgBox:function(){this.ifImg=!0},cancelImgBox:function(){this.ifImg=!1},addDiandi:function(){var e=this;console.log("aa"),""===this.diandiData?i.default.note("点滴内容不能为空",this):"个人点滴"===this.diandiType?"选择类型"===this.type?i.default.note("请选择点滴类型",this):this.pushDiandi&&(this.pushDiandi=!1,wx.showLoading({title:"上传中..."}),wx.request({url:"https://wy.lujiahaoo.cn/dddx/api/personal/essay",method:"POST",data:{writed_at:this.returnTime,tag:this.typeID,content:this.diandiData,image:this.linkData},header:{"content-type":"application/x-www-form-urlencoded",Authorization:"Bearer "+this.token},success:function(n){wx.hideLoading(),200===n.data.code?(i.default.note("提交成功，点滴正在审核中...",e),t.report("per_essay","发布个人点滴"),setTimeout((function(){t.navigateBack(),e.pushDiandi=!0}),1500)):(i.default.note(n.data.msg,e),setTimeout((function(){e.pushDiandi=!0}),1500))},fail:function(t){console.log(t)}})):this.pushDiandi&&(this.pushDiandi=!1,wx.showLoading({title:"上传中..."}),wx.request({url:"https://wy.lujiahaoo.cn/dddx/api/class/essay",method:"POST",data:{writed_at:this.returnTime,content:this.diandiData,image:this.linkData},header:{"content-type":"application/x-www-form-urlencoded",Authorization:"Bearer "+this.token},success:function(n){e.pushDiandi=!0,wx.hideLoading(),200===n.data.code?(i.default.note("提交成功，点滴正在审核中...",e),t.report("class_essay","发布班级点滴"),setTimeout((function(){t.navigateBack()}),1501)):i.default.note(n.data.msg,e)},fail:function(t){console.log(t)}}))},timeModel:function(t){var e=t.toString();return 1===e.length&&(e="0"+e),e}},mounted:function(){var t=this;"code"===wx.getStorageSync("bgColor")?this.ifhot=!1:this.ifhot=!0,a.default.getRequest("/tag",{},(function(e){200===e.data.code&&(t.allType=e.data.data)}),(function(t){console.log(t)}),"GET"),this.token=wx.getStorageSync("token");var e=new Date,n=e.getFullYear(),i=e.getDate(),o=e.getMonth()+1,c=e.getDay(),r=e.getHours(),u=e.getMinutes(),s=e.getSeconds();this.currentWeek=this.week(c),this.currentDate="".concat(this.month(o),"  ").concat(i,",").concat(n),this.returnTime="".concat(n,"-").concat(this.timeModel(o),"-").concat(this.timeModel(i)," ").concat(this.timeModel(r),":").concat(this.timeModel(u),":").concat(this.timeModel(s))}};e.default=u}).call(this,n("543d")["default"])},beee:function(t,e,n){"use strict";var a={"uni-calendar":function(){return Promise.all([n.e("common/vendor"),n.e("components/uni-calendar/uni-calendar")]).then(n.bind(null,"fe3d"))}},i=function(){var t=this,e=t.$createElement;t._self._c},o=[];n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){return a}))},ccdc:function(t,e,n){"use strict";(function(t){n("ae52"),n("921b");a(n("66fd"));var e=a(n("ff3c"));function a(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])},d56f:function(t,e,n){"use strict";var a=n("0efa"),i=n.n(a);i.a},ff3c:function(t,e,n){"use strict";n.r(e);var a=n("beee"),i=n("3ba6");for(var o in i)"default"!==o&&function(t){n.d(e,t,(function(){return i[t]}))}(o);n("d56f");var c,r=n("f0c5"),u=Object(r["a"])(i["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],c);e["default"]=u.exports}},[["ccdc","common/runtime","common/vendor"]]]);